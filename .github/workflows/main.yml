name: Java File Report

on:
  push:
    branches: [main]
jobs:
  java-file-report:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Find all .java files and count lines
        run: |
          set -e
          JAVA_FILES=$(find . -type f -name "*.java")
          JAVA_COUNT=$(echo "$JAVA_FILES" | grep -c . || echo 0)
          if [ "$JAVA_COUNT" -eq 0 ]; then
            echo "No .java files found!"
            exit 1
          fi
          echo "Number of .java files: $JAVA_COUNT" > java-file-report.txt
          TOTAL_LINES=0
          echo "" >> java-file-report.txt
          echo "Per-file breakdown:" >> java-file-report.txt
          for f in $JAVA_FILES; do
            LINES=$(wc -l < "$f")
            TOTAL_LINES=$((TOTAL_LINES + LINES))
            echo "$f â€“ $LINES" >> java-file-report.txt
          done
          echo "" >> java-file-report.txt
          echo "Total lines of code: $TOTAL_LINES" >> java-file-report.txt

      - name: Fail if any .class files are committed
        run: |
          CLASS_FILES=$(git ls-files '*.class')
          if [ -n "$CLASS_FILES" ]; then
            echo "Compiled .class files are committed! This is bad practice."
            echo "$CLASS_FILES"
            exit 1
          fi

      - name: Upload java-file-report.txt as artifact
        uses: actions/upload-artifact@v4
        with:
          name: java-file-report
          path: java-file-report.txt
